<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <script src="./lib/d3.v3.min.js"></script>
    
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
    <style type = 'text/css'>
      .cells {
    background-color: none;
    opacity: 0.6;
    }
   
    #space_div {
    	position: absolute; 
    	left: 10%;
    	right: 0;
    	top: 120px;
    	bottom: 0px;
    	
    	
    }
    #div1 {
    	position: absolute; 
    	left: calc(50%);
    	right: 0;
    	top: 120px;
    	bottom: 0px;
    	
    	display: block;
    	
    	margin: auto;
    }
    line.delimit{
    	stroke: #8A2BE2;
    	stroke-width: 4;
    }
    h1 {
    	display: block;
	    font-size: 2em;
	    margin-left: 50%;
	    margin-right: 0;
	    font-weight: bold;
    }
    text {
    	font-family: Courier New;
    	font-size: 14px
    }
    text.title{
    	font-family: Times;
    	font-size: 20px;
    	font-weight: bold;
    }
    text.Buttons_text{
    	font-family: Times;
    	font-size: 12px;
    }
    line.down{
    	stroke: Goldenrod;
    	stroke-width: 4;
    }
    #myInput {
    background-image: url('/css/searchicon.png'); /* Add a search icon to input */
    background-position: 10px 12px; /* Position the search icon */
    background-repeat: no-repeat; /* Do not repeat the icon image */
    width: 100%; /* Full-width */
    font-size: 16px; /* Increase font-size */
    padding: 12px 20px 12px 40px; /* Add some padding */
    border: 1px solid #ddd; /* Add a grey border */
    margin-bottom: 12px; /* Add some space below the input */
}
#myUL {
    /* Remove default list styling */
    list-style-type: none;
    padding: 0;
    margin: 0;
}
#myUL li a {
    border: 1px solid #ddd; /* Add a border to all links */
    margin-top: -1px; /* Prevent double borders */
    background-color: #f6f6f6; /* Grey background color */
    padding: 12px; /* Add some padding */
    text-decoration: none; /* Remove default text underline */
    font-size: 18px; /* Increase the font-size */
    color: black; /* Add a black text color */
    display: block; /* Make it into a block element to fill the whole list */
}
#myUL li a:hover:not(.header) {
    background-color: #eee; /* Add a hover effect to all links, except for headers */
}
    	
    	
	</style>
    <title>Page and Reel Homepage</title>
  </head>
  <body>
    



	<form>
	    <input type="text" id="imagename" value="" />
	    <input type="button" id="btn" x = "400px" value="GO" />
	</form>
	<link rel="stylesheet" href="demo.css">
	<link rel="stylesheet" href="register.css">
  	
  	<header>
		<h1>Page And Reel</h1>
    </header>
    <div id = "div1" width = "50px">
     <select id="option" left = "10x" width = "200px">
      <option value="Both">Both</option>
      <option value="Movies">Movies</option>
      <option value="Books">Books</option>

      
    </select>
  </div>



    <div id="space_div"></div>
    <label>
     <select class="books-selector1" name="state">
   	  <option value="AL">Search Books</option>
    </select>
    </label>



  	<script type = "text/javascript">
  		function getCookie(name) {
        	var nameEQ = name + "=";
        	var ca = document.cookie.split(';');
        		for(var i=0;i < ca.length;i++) {
            	var c = ca[i];
            	while (c.charAt(0)==' ') c = c.substring(1,c.length);
            	if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
        	}
        	return null;
    	}
    		var userdetails=getCookie("registerDetails")
        	var username=userdetails.substring(0,userdetails.indexOf(','))
        	var ubook = [];
        	var umovies = [];
        	var five_books = [];
        	var five_movies = [];
        	var hp_username = "s"
    $(document).ready(function(){
    	$.when(
   	$.ajax(
    {
        type: "GET",
        url: "http://127.0.0.1:8888/user/"+ hp_username,
        data: "{}",
        dataType: "json",
        success: function (data) {
        	var user_movies = data.moviesHistory;
        	var user_books = data.booksHistory;
        	var f_m = user_movies.split("||");
        	var f_b = user_books.split("||");
        	var i;
        	for (i = 0; i < 5; i++) {
        		ubook.push(f_b[i]);
        		umovies.push(f_m[i]);
        	}
        }
       }),
    	$.ajax({
    		type:"GET",
    		url: "http://127.0.0.1:8888/books",
    		data: "{}",
    		dataType: "json",
    		success: function (data){
    			data = $.map(data, function(obj){
    				ubook.forEach(function(b){
    				if(b==obj.title){
    					five_books.push(obj);
    				}
    			})
    			})
    			
    		}
    	}),
    	$.ajax({
    		type:"GET",
    		url: "http://127.0.0.1:8888/movies",
    		data: "{}",
    		dataType: "json",
    		success: function (data){
    			data = $.map(data, function(obj){
 					umovies.forEach(function(m){
    				if(m==obj.title){
    					five_movies.push(obj);
    				}
    			})
    		})
    			
    		}
    	}),
    	
    	)
    });
  	
    
          var data_all = "Both"; 
         
        
        
         
    //      var listBooks;
    //     var listMovies;
    //     var selectWidth="400px"
    //     $(document).ready(function() {
    //         $('.books-selector1').select2({width: selectWidth});
            
    //         jQuery.getJSON(data_combined).done(
    //         function( data ) {
    //             data = $.map(data, function(obj) {
    //                 return { id: obj.name, text: obj.name }; 
    //             });
    //             $.listBooks=data;
    //             $('.books-selector1').select2({
    //                 width: selectWidth,
    //                 data: $.listBooks
    //             });
                
    //         }
    //     );
    //     $('.movies-selector1').select2({width: selectWidth});
        
    //     jQuery.getJSON('http://localhost:8888/movies').done(
    //     function( data ) {
    //         data = $.map(data, function(obj) {
    //             return { id: obj.name, text: obj.name }; 
    //         });
    //         $.listBooks=data;
    //         $('.movies-selector1').select2({
    //             width: selectWidth,
    //             data: $.listBooks
    //         });
            
    //     });
    // });
   			console.log(five_books)
   			console.log(five_movies)
          var padding_right = 200;
          var padding_to_buttons = 150
         show_it_all(data_all);
        window.addEventListener("resize", function(d){
        	var div_space = document.getElementById("space_div");
        	show_it_all(data_all);
        });
         // console.log(data_all);
         // console.log(data[0]);
         // console.log(data2[0]);
        var drow_box = d3.select("#option").on("change", function(d){
          d3.selectAll("svg").remove();
          data_all=  d3.select(this).property('value');
          console.log(data_all)
          show_it_all(data_all);
        }).attr();
    
    function show_it_all(data_all){
        var line_limit=1;
        d3.selectAll("svg").remove();
            var div_space = document.getElementById("space_div");
            var inc = 0;
		   width = div_space.clientWidth
	       if (width < 520){
	       	width  = 520;
	       }
	       else if (width > 1300){
	       	width = 1300;
	       }
	       console.log(width)
	          var height = 200; 
	          var pad = 120; var padding = 10;
	          var pad_left = 30;
	         var more;
	        document.getElementById('btn').onclick = function() {
	            var val = document.getElementById('isbn_13').value,
	                src =  val,
	                book = document.createElement('book');
	            book.src = src;
	            document.body.appendChild(book);
	        }
	  function pos_x(attr){
	      if (attr < 5){
	        
	        return 150;
	      }
	      else{
	        y_pos = 0;
	        return padding+pad*2;
	      }
	    }
	    function post_y(attr, inc){
	      
	        return 20*inc
	      
	    }
	    //derived from https://bl.ocks.org/mbostock/7555321 Wrapping long labels in D3
	    var title_lines=1;
	    function wrap_words(text, width, lines, tf) {
	    text.each(function () {
	        var text = d3.select(this),
	            
	            words = text.text().split(/\s+/).reverse(),
	            word,
	            line = [],
	            lineNumber = 0,
	            lineHeight = 1.1, // ems
	            x = text.attr("x"),
	            y = text.attr("y"),
	            dy = 0, //parseFloat(text.attr("dy")),
	            tspan = text.text(null)
	                        .append("tspan")
	                        .attr("x", x)
	                        .attr("y", y)
	                        .attr("dy", dy + "em");
	        while (word = words.pop()) {
	          if (lineNumber < lines-1){
	            line.push(word);
	            tspan.text(line.join(" "));
	            //limit the number of lines in summary
	            if (lineNumber > lines-1){
	              break; break;
	            }
	            //TODO figure out putting ... at end
	            else if (tspan.node().getComputedTextLength() > width) {
	                if (tf != "GoodReads_Title" || tf != "Description_Cleaned"){
	                  ++line_limit;
	                }
	              
	               
	                if (lineNumber < lines-1){
	                line.pop();
	                tspan.text(line.join(" "));
	                line = [word];
	                tspan = text.append("tspan")
	                            .attr("x", x)
	                            .attr("y", y)
	                            .attr("dy", ++lineNumber * lineHeight + dy + "em")
	                            .text(function(d){
	                              if (lines-1 == lineNumber){
	                              }
	                              else {
	                                return word;
	                              }
	                            });
	                }
	            }
	          }
	        }
	    });
	  }
	  function show_summary(value){
	       
	      var show_s = space.append("rect").style("position", "absolute").attr("width", 300).attr("height", 200).attr("id", "desc").style("opacity", 0.6).style("fill", "grey");
	      var show_w = show_s.append("text").text(value)
	        
	    }
	    function mouseout(){
	      d3.select("#desc").remove();
	    }
	//Books
	    function determine_attr(attr){
	      if (attr == "isbn13"){
	        return "isbn13: ";
	      }
	      else if (attr == "title"){
	        return "Title: ";
	      }
	      else if (attr == "author_names"){
	        return "Author(s): ";
	      }
	      else if (attr == "url"){
	        return "URL: ";
	      }
	      else if (attr == "tating"){
	        return "Rating: ";
	      }
	      else if (attr == "year"){
	        return "Date of Publication(s): ";
	      }
	      else if (attr == "description"){
	        return "Summary";
	      }
	    }
	  if (data_all != "Movies"){
	   five_books.forEach(function(el){
	   	inc+=1
	   // console.log(el)
	    
	    
	    
	    var keys = Object.keys(el);
	    
	  
	    var space = d3.select(div_space).append("svg").attr("width", width).attr("height", height).style("fill", "red" ).style("opacity", 1).attr("class", "cells").attr("align", "center");
	    space.append("line").attr("class", 'delimit').attr("x1", 0).attr("y1", height).attr("x2", width).attr("y2", height);
	   // var rect = space.append("rect").attr("x", 0).attr("y", 0).attr("width", width)
	   // .attr("height", height).style("stroke", " DarkMagenta").style("fill", "none").style("stroke-width", "8");
	    var gl = space.append("g").attr("transform", "translate(0, 00)");
	    space.append("line").attr("class", "down").attr("x1", 0).attr("y1", 0).attr("x2", 0).attr("y2", height);
	    var options = [ "Choose an option", "Books ", "Movies", "Both"]
	    //var drop_down = space.append("select").attr("class", "select").on("change", drops);
	   // var select_options = space.selectAll("option").data(options).enter().append("option").text(function(d){
	     // return d;
	    //}).attr("transform", "translate(250, 160)");
	    /*
	   */
	    function go_to_goodreads(isbn13){
	      var a = isbn13.split(',');
	     // console.log(a[0])
	      window.location.href = "https://www.goodreads.com/search?q="+a[0];
	    }
	    var array = ["isbn", "title", "author_names", "year", "rating", "url", "description", "genres"]
	    Object.entries(el).forEach(([attr, value]) =>{
	      
	      if (array.indexOf(attr) > -1){
	      
	      if (attr == "url"){
	       // console.log(value)
	       var img = gl.append("svg:image")
	    .attr("xlink:href", value)
	    .attr("width", 150)
	    .attr("height", 175)
	    .attr("viewBox", "0, 0, 300, 300")
	    .attr("x", pad_left-30)
	    .attr("y",10).style("fill", "black");
	      }
	      else if (attr == "title"){
	        
	        gl.append("text").attr("class", "node").
	        attr("x", pad_left+120).attr("y", 20).text(value).call(wrap_words, width-padding_right-padding_to_buttons, 3, attr, el.Author_names).style("fill", "black").attr("class", "title");
	      }
	      
	      else if (attr == "author_names"){
	         space.append("text").attr("x", pad_left + 120).attr("y", 140).text("by "+value).style("fill", "DarkOrange").call(wrap_words,width-padding_right-padding_to_buttons, 3, attr);
	      }
	      
	      else if (attr == "rating"){
	         space.append("text").attr("x",  width-padding_right).attr("y", 20).text("Rating: "+value).style("fill", '#8A2BE2').call(wrap_words, width-padding_right, 2, attr).attr("class", "Buttons_text").style("font-size", 18);
	      }
	      else if (attr == "genres"){
	        space.append("text").attr("x",  pad_left+120).attr("y", 100).text(value).style("fill", "Black").call(wrap_words,width-padding_right-padding_to_buttons, 2, attr).call(wrap_words, width-padding_right-padding_to_buttons, 2, attr);
	      }
	      else if (attr == "year"){
	         space.append('text')
	        .attr("x", pad_left+120)
	        .attr("y", 70)
	        .style("fill", "black")
	        
	        .text(determine_attr(attr)+value).call(wrap_words, width-padding_right-padding_to_buttons, 3, attr);
	      }
	     
	      else if (attr == "isbn" ){
	        space.append('text')
	        .attr("x", pad_left+120)
	        .attr("y", 120)
	        .style("fill", "black")
	        .text(determine_attr(attr)+value).call(wrap_words, width-padding_right-padding_to_buttons, 2, attr);
	      }
	      else if (attr == "description"){
	        gl.append("text").attr("class", "node").
	        attr("x", pad_left+120).attr("y", 160).text(value).call(wrap_words, width-padding_right, 4, attr).style("fill", "black");
	        gl.append("rect").attr("x", width-padding_right).attr("y", 60).attr("height", 15).attr("width", 150).style("opacity", 1).style("fill", "#8A2BE2").on("click", function(){
	          return go_to_goodreads(el.isbn_13);
	        }).attr("cursor", "pointer");
	        gl.append("text").text("Go to GoodReads").style("fill", "whitesmoke").attr("x", width-padding_right+75).attr("y", 72).attr("text-anchor", "middle").attr("cursor", "pointer").style("font-weight", "bold").on("click", function(){
	          return go_to_goodreads(el.isbn_13);
	        }).attr("class", "Buttons_text");
	        gl.append("rect").attr("x", width-padding_right).attr("y", 90).attr("height", 15).attr("width", 150).style("opacity", 1).style("fill", "GoldenRod").attr("cursor", "pointer").on("click", function(){
	        		d3.selectAll("svg").remove();
		        	show_it_all("Both")
		        });
	        gl.append("text").text("Search via Page and Reel").style("fill", "whitesmoke").attr("x", width-padding_right+75).attr("y", 102).attr("text-anchor", "middle").attr("cursor", "pointer").style("font-weight", "bold").attr("class", "Buttons_text");
        
       
		      }
		      }
		      
		      })
		      
		    });
		  }
//################################################################################################3
	//Movies
	  if (data_all != "Books"){
		   // console.log(data_all)
		    five_movies.forEach(function(el){
		   // console.log(el)
		    
		    
		    
		    var keys = Object.keys(el);
		    var div_space = document.getElementById("space_div");
		    
		    
		    
		    var space = d3.select(div_space).append("svg").attr("width", width).attr("height", height).style("fill", "red" ).style("opacity", 1).attr("class", "cells");
		   // var rect = space.append("rect").attr("x", 0).attr("y", 0).attr("width", width)
		    //.attr("height", height).style("stroke", " DarkMagenta").style("fill", "none").style("stroke-width", "8");
		     space.append("line").attr("class", "delimit").attr("x1", 0).attr("y1", height).attr("x2", width).attr("y2", height);
		    var gl = space.append("g").attr("transform", "translate(0, 00)");
		   	space.append("line").attr("class", "down").attr("x1", 0).attr("y1", 0).attr("x2", 0).attr("y2", height);
		    // console.log(data2[0])
		    
		    function go_to_imdb(code){
		      var a = code.split(',');
		      //console.log(a[0])
		      window.location.href = "http://www.imdb.com/title/"+a[0]+"/";
		      console.log( "http://www.imdb.com/title/"+a[0]+"/");
		    }
		    var array = ["plot", "actors", "rating", "genres", "imdbid", "rated", "title", "year", "writer", "poster", "director", "runtime"]
		    Object.entries(el).forEach(([attr, value]) =>{
		      gl.append("rect").attr("x", width-padding_right).attr("y", 60).attr("height", 15).attr("width", 150).style("opacity", 1).style("fill", "#8A2BE2").on("click", function(){
		          return go_to_imdb(el.imdbid);
		        }).attr("cursor", "pointer");
		        gl.append("text").text("Go to IMDB").style("fill", "whitesmoke").attr("x", width-padding_right+75).attr("y", 72).attr("text-anchor", "middle").attr("cursor", "pointer").style("font-weight", "bold").on("click", function(){
		          return go_to_imdb(el.imdbid);
		        }).attr("class", "Buttons_text");
		        gl.append("rect").attr("x", width-padding_right).attr("y", 90).attr("height", 15).attr("width", 150).style("fill", "GoldenRod").style("opacity", 1).attr("cursor", "pointer").on("click", function(){
	        		d3.selectAll("svg").remove();
		        	show_it_all("Both")
		        });
		        gl.append("text").text("Search via Page and Reel").style("fill", "whitesmoke").attr("x", width-padding_right+75).attr("y", 102).attr("text-anchor", "middle").attr("cursor", "pointer").style("font-weight", "bold").attr("class", "Buttons_text");
		      if (array.indexOf(attr) > -1){
		      if (attr == "plot"){
		        gl.append("text").attr("class", "node").
		        attr("x", pad_left+120).attr("y", 160).text(value).call(wrap_words, width-padding_right, 4, attr).style("fill", "black");
		        
		        
		        
		       
		      }
		      
		      else if (attr == "poster"){
		        console.log(value)
		       var img = gl.append("svg:image")
		    .attr("xlink:href", value)
		    .attr("width", 150)
		    .attr("height", 175)
		    .attr("x", pad_left-30)
		    .attr("y",10).style("fill", "black");
		      }
		      
		      else if (attr == "title"){
		        
		        gl.append("text").attr("class", "node").
		        attr("x", pad_left+120).attr("y", 20).text(value).call(wrap_words, width-padding_right, 2, attr).style("fill", "black").attr("class", "title");
		      }
		      else if (attr == "writer"){
		         space.append("text").attr("x", pad_left + 120).attr("y", 140).text("Writer: "+value).style("fill", "GoldenRod").call(wrap_words, width-padding_right-padding_to_buttons, 2, attr);
		         
		      }
		      else if (attr == "rating"){
		         space.append("text").attr("x",  width-padding_right).attr("y", 20).text("Rating: "+value).style("fill", "#8A2BE2").attr("class", 'Buttons_text').style("font-family", "Georgia").style("font-size", 18);
		      }
		      else if (attr == "year"){
		        space.append("text").attr("x",  pad+pad_left).attr("y", 40).text("("+value+")").style("fill", "8A2BE2").call(wrap_words, width-padding_right-padding_to_buttons, 2, attr);
		      }
		      else if (attr == "runtime"){
		        space.append("text").attr("x",  pad+pad_left).attr("y", 60).text("runtime: "+value+"").style("fill", "black").call(wrap_words, width-padding_right-padding_to_buttons, 2, attr);
		      }
		      else if (attr == "actors"){
		        space.append("text").attr("x",  pad+pad_left).attr("y", 100).text("Actors: "+value).style("fill", "black").call(wrap_words, width-padding_right-padding_to_buttons, 2, attr);
		      }
		      }
		      
		      })
	      
	   		 });
		  }
		
	}
	   //d3.select(window).on('resize', show_it_all(data_all))
  
    
  		
  	</script>
  </body>
</html>